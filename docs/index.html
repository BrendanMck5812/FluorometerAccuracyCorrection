<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.55">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Final1</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Final1</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <span class="nav-link">
<span class="menu-text">about.qmd</span>
    </span>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#correcting-field-fluorometer-data-accuracy-for-efficient-algal-level-monitoring" id="toc-correcting-field-fluorometer-data-accuracy-for-efficient-algal-level-monitoring" class="nav-link active" data-scroll-target="#correcting-field-fluorometer-data-accuracy-for-efficient-algal-level-monitoring">Correcting Field Fluorometer Data Accuracy for Efficient Algal level Monitoring</a>
  <ul class="collapse">
  <li><a href="#manatee-county-natural-resources-department-environmental-protection-division-intern-brendan-mcknight" id="toc-manatee-county-natural-resources-department-environmental-protection-division-intern-brendan-mcknight" class="nav-link" data-scroll-target="#manatee-county-natural-resources-department-environmental-protection-division-intern-brendan-mcknight"><em>Manatee County Natural Resources Department-Environmental Protection Division; Intern Brendan McKnight</em></a></li>
  </ul></li>
  <li><a href="#narrative" id="toc-narrative" class="nav-link" data-scroll-target="#narrative">Narrative</a></li>
  <li><a href="#about" id="toc-about" class="nav-link" data-scroll-target="#about">About</a></li>
  <li><a href="#methodology" id="toc-methodology" class="nav-link" data-scroll-target="#methodology">Methodology</a>
  <ul class="collapse">
  <li><a href="#correction-procedure" id="toc-correction-procedure" class="nav-link" data-scroll-target="#correction-procedure">Correction Procedure</a></li>
  <li><a href="#quality-assurance" id="toc-quality-assurance" class="nav-link" data-scroll-target="#quality-assurance">Quality Assurance</a></li>
  </ul></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a>
  <ul class="collapse">
  <li><a href="#linear-regression-field-vs.-lab-measurements" id="toc-linear-regression-field-vs.-lab-measurements" class="nav-link" data-scroll-target="#linear-regression-field-vs.-lab-measurements">Linear Regression: Field vs.&nbsp;Lab Measurements</a></li>
  <li><a href="#correction-value-scatter-plot-corrected-vs.-uncorrected-methodology" id="toc-correction-value-scatter-plot-corrected-vs.-uncorrected-methodology" class="nav-link" data-scroll-target="#correction-value-scatter-plot-corrected-vs.-uncorrected-methodology">Correction Value Scatter plot: Corrected vs.&nbsp;Uncorrected Methodology</a></li>
  <li><a href="#measurement-range-lab-vs.-field-data" id="toc-measurement-range-lab-vs.-field-data" class="nav-link" data-scroll-target="#measurement-range-lab-vs.-field-data">Measurement Range: Lab vs.&nbsp;Field Data</a></li>
  </ul></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion">Discussion</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">




<section id="correcting-field-fluorometer-data-accuracy-for-efficient-algal-level-monitoring" class="level1">
<h1>Correcting Field Fluorometer Data Accuracy for Efficient Algal level Monitoring</h1>
<section id="manatee-county-natural-resources-department-environmental-protection-division-intern-brendan-mcknight" class="level3">
<h3 class="anchored" data-anchor-id="manatee-county-natural-resources-department-environmental-protection-division-intern-brendan-mcknight"><em>Manatee County Natural Resources Department-Environmental Protection Division; Intern Brendan McKnight</em></h3>
</section>
</section>
<section id="narrative" class="level1">
<h1>Narrative</h1>
<p>In Florida waterways, algae blooms have become a common threat to the environment and the citizens of Florida. Algae blooms release chemicals into the air and water that can harm humans and kill lots of wildlife, therefore, algae level monitoring has become a necessary protocol for environmental agencies. The current method of determining algae levels is not very time and labor efficient and involves taking samples from sites and analyzing them in a lab. Current field equipment has the capabilities to determine algae levels, however it’s accuracy remains an issue due to how it works. This project investigated the accuracy of this equipment and formulated a methodology to be able to gather reliable data on algae levels efficiently while in the field. With this new method, environmental agencies can determine algae levels and respond to them faster, as well as better investigate the causes of these blooms and the best actions to prevent it.</p>
</section>
<section id="about" class="level1">
<h1>About</h1>
<p>An important aspect of water quality monitoring is nutrient and algae levels, When there are lots of nutrients in the water, algae populations explode causing harmful algae blooms. It is very important that government and environmental agencies can quickly and accurately monitor levels to take action and inform citizens of dangers to air quality, drinking water, seafood, etc. The Environmental Protection Agency as well as the National Oceanic and Atmospheric Administration fund programs aimed at investigating the ecology, monitoring, event response, and prevention and control of harmful algal blooms. These programs emphasize the importance for scientists to have access to efficient methods of accurate data collection to be able to investigate and respond quickly, as well as to produce more data for better investigation. This project aims to support that same agenda by developing a methodology for using field fluorometers that gives scientists an accurate way to determine the algae level of a waterway without having to take any samples back to a lab for analysis.</p>
<p>The Manatee County Natural Resources department has two programs that assess water quality both off the coast of Tampa and Sarasota Bay, as well as in freshwater systems that lead into those bays. These programs are named the Regional Ambient Monitoring Program (RAMP) and Surface Water Ambient Monitoring Program (SWAMP). There are 80 sites in total between the two programs where water quality is regularly assessed. Chlorophyll a analysis must be carried out to determine the concentration of algae in the water during these assessments. This involves over 9 different processes from sample event to chlorophyll a determination that always take an entire work day. Because of the time and energy needed to do chlorophyll a analysis for all 80 sites, data is mostly only recorded once a month at each location. This means that current data collection procedures do not produce enough results to be able to investigate. With a method of gathering this data that involves simply visiting a site and dipping a fluorometer into the water you wish to test, much more can be done in the fight to protect our waterways. Manatee County can use this access to loads more data to develop highly accurate and up to date systems for not only monitoring algae levels across the county, but developing the best strategies to prevent and control algae populations.</p>
<p>Fluorometers serve as an efficient method to record values of chlorophyll a concentration in both fresh and saltwater, by emitting UV light and recording the irradiance emitted as a result of the light interaction with phytoplankton light harvesting complexes. Simply put, they send out light and record how much light is reflected back, which is representative of the density of phytoplankton in the water by chlorophyll a concentration. The more commonly used method uses a fluorometer, however this fluorometer requires preparation of samples and is laboratory bound. This method is used instead because its accuracy is verified and there are no interfering factors that can alter data. Despite this, the time needed to collect, transport, filter, freeze, and prepare samples makes this method too inefficient to consistently monitor algae levels. Therefore, it would be beneficial to investigate the data collection trends and results using the field based fluorometer to formulate a procedure for efficient algae monitoring with adequate data accuracy.</p>
</section>
<section id="methodology" class="level1">
<h1>Methodology</h1>
<section id="correction-procedure" class="level3">
<h3 class="anchored" data-anchor-id="correction-procedure">Correction Procedure</h3>
<p>Below is a summarized method of correcting the field based fluorometer. To view in depth step-by-step instructions on this method, along with the list of necessary equipment, view the fluorometer correction SOP.</p>
<ol type="1">
<li><p>Collect data set from field measurements and collection that match with the lab analyzed chlorophyll a concentration, investigate any trends, compare field to lab measurements.</p></li>
<li><p>Conduct field collection and measurement aimed at determining the correct depth for accurate measurements, analyze data and set depth requirements.</p></li>
<li><p>Determine range of algae levels that you are confident in field measurement accuracy and that serve as a range of normal algae levels.</p></li>
<li><p>Conduct any remaining investigations of confounding factors if found in previous data trends.</p></li>
<li><p>Employ depth requirements and range of confidence to create data set from field measurements and collection that match with the lab analyzed chlorophyll a concentration.&nbsp;</p></li>
<li><p>Investigate the relationship between field and lab measurements, determine correction formula.</p></li>
<li><p>Implement new field data collection method to increase data collection.</p></li>
</ol>
</section>
<section id="quality-assurance" class="level3">
<h3 class="anchored" data-anchor-id="quality-assurance">Quality Assurance</h3>
<p>The main purpose of investigating the data coming from the field based fluorometer was to determine what is causing the data to vary so much. The goal was to identify this, determine a technique that greatly reduced variance and increased the accuracy of measurements. After this is determined, employ these new techniques and investigate the data to see if there is any factor that is still affecting the accuracy or variance of data coming from the field based fluorometer. The two factors affecting measurements in Manatee County are depth and the density of algae in the water. Your environment may pose more factors affecting accuracy and variance, therefore, I encourage thorough examination of data coming in throughout the process of correcting the fluorometer to catch any and all confounding factors</p>
<p><strong><em>Depth</em></strong></p>
<p>Because the fluorometer determines the concentration of chlorophyll a based off of the light that is hitting its sensors, light coming from the sun can affect the measurement. To collect data that is free of interference from, the depth at which sunlight is no longer a factor must be determined. This depth may be different for environments with different conditions, for example, in my testing, different salinity/conductivity environments had different depth requirements. This is because of a couple of reasons. One is that freshwater is a lot more clear than brackish or salt water, so sunlight travels further in the water causing freshwater depth requirements to be at depths closer to the bottom. However, salt water, because of the higher conductivity, is not as clear, and so sunlight dissipates quicker. Along with this, certain salt water bottoms can be lightly colored which can affect the measurements. This makes closer to the surface the proper depth requirement for salt water. Brackish water, because of its mix between the two, shows a depth between the two depths of salt and fresh water.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Figure 2: Each aquatic environment within my research scope has a depth at which measurements are most accurate, as determined by comparison of error in measurement. Full saltwater measurements are most accurate at 0.15 meters. Brackish water measurements are most accurate at 0.45 meters. Freshwater measurements are most accurate at 0.75 meters.</p>
<p><strong><em>Confidence Range</em></strong></p>
<p>One of the trends I began seeing when going through the data was that the higher the chlorophyll a concentration, the more error between the field and lab determined concentrations. Through analyzing data it became clear that when a bloom is occurring, it is considerably more difficult to get a stable measurement of chlorophyll a in the water. Algae are not evenly distributed throughout the water when this is happening and so water at one site can range upwards of 10 to 15 ug/L. At this point, accurate monitoring of algae levels is less urgent and the event response to that algae bloom becomes more important. Because of this, A range must be set of the chlorophyll a concentrations that the fluorometer can accurately read. To formulate this range, I took historic records of chlorophyll a in the waterways I was testing and determined a 95% confidence interval at 37.5 ug/L to be my upper limit. This indicated to me that chlorophyll a levels above 37.5 ug/L are outside the normal levels found in these waterways. When measurements above 37.5 ug/L were then removed from the dataset, the accuracy of the correction formula was greatly increased. This range serves two purposes. One is to reduce the error in the correction formula and make it fit the data as best as it can. The second is to determine a level of chlorophyll a at which alarm bells should be raised because it is outside of the normal range of algae levels, signaling that monitoring needs to be turned into event response and control. The data at your disposal may be different and you will most likely have to formulate your own method to determine your own range.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Figure 2: Range of algae levels where accurate measurement is possible determined to be from 0-37.5 ug/L. Measurements outside of this range are not to be used in correction formula formulation and should be addressed as possibility for harmful algal bloom is present.</p>
<p>As mentioned before, it is important to go through your data as you are collecting it and investigate any relationships that may end up being confounding factors you have to come up with requirements for. This may involve developing your own method to investigate these confounding factors.</p>
</section>
</section>
<section id="results" class="level1">
<h1>Results</h1>
<section id="linear-regression-field-vs.-lab-measurements" class="level3">
<h3 class="anchored" data-anchor-id="linear-regression-field-vs.-lab-measurements">Linear Regression: Field vs.&nbsp;Lab Measurements</h3>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="correction-value-scatter-plot-corrected-vs.-uncorrected-methodology" class="level3">
<h3 class="anchored" data-anchor-id="correction-value-scatter-plot-corrected-vs.-uncorrected-methodology">Correction Value Scatter plot: Corrected vs.&nbsp;Uncorrected Methodology</h3>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="measurement-range-lab-vs.-field-data" class="level3">
<h3 class="anchored" data-anchor-id="measurement-range-lab-vs.-field-data">Measurement Range: Lab vs.&nbsp;Field Data</h3>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="discussion" class="level1">
<h1>Discussion</h1>
<p>[conclusion section]</p>
</section>
<section id="references" class="level1">
<h1>References</h1>
<section id="manuals-and-sops" class="level4">
<h4 class="anchored" data-anchor-id="manuals-and-sops">Manuals and SOP’s</h4>
<ol type="1">
<li><p><a href="sop/Correcting Field Fluorometer Accuracy SOP.pdf"><em>Correcting Field Fluorometer Accuracy SOP</em></a></p></li>
<li><p><em>Calibrating Eureka Manta2 Fluorometer</em></p>
<ol type="1">
<li><p><a href="sop/Post-It Calibration Method SOP.pdf"><em>Post-It Calibration Method SOP</em></a></p></li>
<li><p><a href="sop/Eureka Submersible Fluorometer Calibration Manual.pdf"><em>Eureka Submersible Fluorometer Calibration Manual</em></a></p></li>
<li><p><a href="sop/Eureka Submersible Fluorometer User Manual.pdf"><em>Eureka Submersible Fluorometer User Manual</em></a></p></li>
<li><p><a href="sop/Eureka Submersible Fluorometer Optical Specification Guide.pdf"><em>Eureka Submersible Fluorometer Optical Specification Guide</em></a></p></li>
</ol></li>
<li><p><a href="sop/Eureka Manta Multiprobe Manual.pdf"><em>Eureka Manta Multiprobe Manual</em></a></p></li>
<li><p><a href="sop/Field Sample Collection SOP.pdf"><em>Field Sample Collection SOP</em></a></p></li>
<li><p><a href="sop/EPA Method 445.0 Chlorophyll a Determinations SOP.pdf"><em>EPA Method 445.0 Chlorophyll a Determinations SOP</em></a></p></li>
</ol>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>